![img](2
JINGWEI HIRAIN
JINGWEI HIRAIN)
![img](tmp/112495152898_pptx.dat_19_ppt_media_image14.jpeg)
SWC+RTE Principle and Usage Training

Hirain Technologies
Zhang Jiao AE Chengdu Embedded Software Department


Contents


RTE Overview

1

2

RTE Principle

3

RTE Communication Methods and Configuration



1

Overview



● AUTOSAR Architecture


![img](Application Layer
AUTOSAR Runtime Environment (RTE)
Services Layer
Complex
ECU Abstraction Layer
Drivers
Microcontroller Abstraction Layer
Hardware)
![img](Microcontroller Drivers
Memory Drivers
Communication Drivers
I/O Drivers)
![img](I/O Hardware Abstraction)
![img](Onboard Device
Communication
Memory Hardware
Hardware Abstraction
Abstraction
Abstraction)
![img](System Services
Memory Services
Communication Services)


● SWC


Atomic SWC
Composition SWC
Software Component(SWC)


Composition

Atomic
SWC

SWC

Atomic
SWC

Atomic
SWC



● SWC


Different Types of Atomic SWC
● Application SWC
● Most commonly used SWC
● Service SWC
● Provided by BSW layer, SWC mapped from service modules
● NvM, Com, EcuM, ComM…


Application
SWC

Nv Block
SWC

Sensor Actuator
SWC

Parameter
SWC

RTE

Service SWC

ECU Abstraction SWC

CDD SWC

MCAL



IoHwAbs

● SWC

Sensor Actuator SWC
● Represents the function of sensor or actuator, interacts with Ecu Abstraction SWC under RTE, and interacts with other Application SWC above.
Ecu Abstraction SWC
● Abstracts MCAL layer interface into RTE interface, realizes interaction with Sensor Actuator SWC.





RTE

Application
SWC

ECU Abstraction SWC

Sensor Actuator
SWC

MCAL







● SWC


Different Types of Atomic SWC
● Suitable for different usage scenarios
● Support specific types of port interface
● Have Port direction and type restrictions
● Can be replaced by Application SWC





SWC
● Port
● Runnable
● RTE Event



● RTE

VFB
● Virtual Function Bus
● Abstract concept for communication between SWCs

![img](yi an s
AUTOSAR
AUTOSAR
AUTOSAR
AUTOSAR
SC
SC
-SC
SC
2
Derpiuinn
Derpiunn
Derpiuinn
Derpin
S
SC
SC
SC)
ECU1

RTE


ECU2

RTE


RTE
● VFB implementation for a single ECU






● RTE——Inter-module Communication

Concepts
● SWC
● Port
● Connects SWCs to enable communication between them
● Global concept, not SWC attribute
● Direction
● Provide Port (P Port)
● Request Port (R Port)
● Port Interface
● Specifies the type and specific content of the connection between SWCs
● Instantiation of Port Interface




Together, they specify the direction and content of data flow

SWC

SWC


P

R

Port Interface






SWC

R


Port Interface



● PortInterface


Types
● Sender-Receiver Interface
● Client-Server Interface
● Mode-Switch Interface
● Trigger Interface
● NvData Interface
Different Port Interface types determine different scheduling methods
● Different Runnable triggering methods
● Different formats of RTE API
● Different RTE API access methods


● Data Types


Data Type
● Defines parameter types for Data Element, Operation, etc.
● Basic type
● uint8/uint16/sint8…
● Defined in Std_Types.h file
● Implementation type
● Array, Enum, Structure…
● Generated in Rte_Types.h file

Others
● Constant: Defines initial values, invalid values, etc.
● Data Constr: Restricts range


● Data Types


![img](tmp/112495152898_pptx.dat_30_ppt_media_image25.png)
![img](0
Project Trees
x
InternalBehavior
Interface_Sig0 ×
SR
General
newProject
Is Service
DataTypes
Portlnterface
Service Kind
B Arlnterface
Data Element
SR
Interface_Sig0
SWCs
v DataElement0
AppSWCReceiver
Init Value
AppSWCReceiver.grap
Type
ImplTypeNew
InternalBehavior
Ports
Right click to add
Handle Invalid
ReceiverSigPort
SR
DataPrototype
Sw Implementation Policy)

● RTE ——Inter-module Communication


Communication Types
● Communication between SWCs
● Communication between SWC and BSW
● Communication between ECUs

ECU1

RTE

BSW

SWC

SWC

SWC

ECU2

RTE

BSW

SWC

SWC

SWC

CAN/LIN/Ethernet



HW

HW




● RTE——Intra-module Behavior


Concepts
● SWC
● Port
● Port Interface
● Runnable
● RTE Event

SWC

Runnable

Runnable

Event





Event



● Runnable、Access


Runnable: A program instance that can be started by RTE
Defined in Atomic SWC
One or more Runnables can be defined in one SWC
Access Port is defined in Runnable to access Port, thus communicating with other SWCs

![img](SW-C
Runnable_i
Runnable_0
C)

● RTEEvent


Trigger source of Runnable, used to activate Runnable
Each RTE Event can only trigger one Runnable
One Runnable can be triggered by multiple trigger sources


![img](SWC
RTEEvent 0
RTEEvent 1
RTEEvent i
Runnable 0
Runnable i)

● RTEEvent


Type
● Init Event -- Activate runnable on initialization of RTE
● Timing Event -- Cycle activate Runnable
● Data Received Event
● Data Receive Error Event
● Data Send Completed Event
● Data Write Completed Event
● Operation Invoked Event
● Mode Switch Event
● …




SR Port

CS Port


Mode Switch Port




● RTE——Intra-module Behavior


Scheduling of Runnable
● Periodically trigger Runnable
● Event-triggered Runnable

SWC

Runnable


Timing event


Non-timing event


OS Task/Event



Trigger

Map



● RTEEvent与OSEvent


RTE Event / OS Event

Mapped to OS Task/Event
● When an event occurs, scheduling Runnable in task is realized by calling ActivateTask or SetEvent

Not mapped to OS Task/Event
● Directly call Runnable when event occurs




● RTEEvent

Init Event
● Init Event – Activate Runnable during RTE initialization
● Usually used to implement SWC initialization
● Triggered in Rte_Start()


Rte_Start()
{
    init_Runnable()
}

Init Task


Rte_Start()
{
    ActivateTask()
}

Init Task


init_Runnable()
{
    
}

SWC Init Task




SWC

init_Runnable

Init Event





No Mapping



Mapping



● RTEEvent

Timing Event
● Periodically activate Runnable
● Need to map to periodic OS task or event


10ms_Runnable();



10ms Task



● The Role of RTE


Provides a unified interface for application layer SWC, allowing modules to focus on internal behavior and freeing from data exchange between modules
Unified planning of application layer scheduling
Isolates application layer and BSW layer, improving portability


RTE

SWC1

Rte_ReadSignalA()



SWC2

Rte_WriteSignalA()


A




IO_Read



Com_ReceiveSig





● Communication Example

SWC Dimmer

Runnable
SA_Door_Left


500ms Event


SWC Lighter

Runnable
LightCtrl









DataReceivedEvent


Trigger

Trigger

Access

Access

Access



From Com

Map


Task2


LightDimmer_SRIf


Com




![img](Task500ms ()
{
Runnable_SA_Door_Left ();
{
Task2 ()
{
Runnable_LightCtrl();
}
Rte_Read_ SA_Door_Left (boolean * val)
{
Com ReceiveSignal(sigId, val) ;
{
uint8 g_Light_Dimmer;
Rte_Write_LightDimmer(uint8 val)
{
g_Light_Dimmer=val;
ActivateTask (Task2); /* trigger runnbale of light*/
{
Rte_Read_LightDimmer (uint8 * val)
{
*val=g_Light_Dimmer;)
● Code Example

Rte.c

Dimmer.c

Light.c

![img](Runnable_SA_Door_Left ()
{
boolean dooropen;
Rte_Read_ SA_Door_Left (&dooropen) ;
/* user code */
Rte_Write _LightDimmer(lightval);
})
![img](Runnable_LightCtrl()
{
uint8 tmpLight_Dimmer;
Rte_Read_LightDimmer (&tmpLight_Dimmer);
/* user code, ctrl light based on Light_Dimmer*/)












![img](Task2()
Runnable_LightCtrl() ;)















![img](Task500ms ()
{
Runnable_SA_Door_Left ();
{
Task2 ()
{
Runnable_LightCtrl();
}
Rte_Read_ SA_Door_Left (boolean * val)
{
Com ReceiveSignal(sigId, val) ;
{
uint8 g_Light_Dimmer;
Rte_Write_LightDimmer(uint8 val)
{
g_Light_Dimmer=val;
ActivateTask (Task2); /* trigger runnbale of light*/
{
Rte_Read_LightDimmer (uint8 * val)
{
*val=g_Light_Dimmer;)
● Code Example

Rte.c

Dimmer.c

Light.c

![img](Runnable_SA_Door_Left ()
{
boolean dooropen;
Rte_Read_ SA_Door_Left (&dooropen) ;
/* user code */
Rte_Write _LightDimmer(lightval);
})
![img](Runnable_LightCtrl()
{
uint8 tmpLight_Dimmer;
Rte_Read_LightDimmer (&tmpLight_Dimmer);
/* user code, ctrl light based on Light_Dimmer*/)
● Each SWC focuses on internal behavior
● Dimmer and Light use interfaces for reading and writing
● Scheduling of Runnable is managed by Rte
● SWC and BSW are isolated, improving portability
● Dimmer reads signals through Rte_Read interface, sigId is not coupled with Dimmer, after underlying changes, only remapping is needed without modifying application layer



● Generate RTE




RTE
● No core code, all code is generated
● Code for a single ECU

SWC Designer

BSW Configurator

RTE Generator


Arxml

RTE
Source Code





● RTE


Concept Summary
● Data Type
● Constant
● SWC
● Port
● Port Interface
● Runnable
● RTE Event


3

RTE Communication Methods



● 6 Communication Methods


Types
● Sender-Receiver Communication
● Client-Server Communication
● Mode-Switch Communication
● Trigger Communication
● NvData Communication
● Parameter Communication



● Sender-Receiver Concept


Sender Receiver Interface(SR)
● A communication method
● DataElement: Basic unit of data transmission and reception
● Multiple Data Elements can be defined in one SR Interface
● Each Data Element can be configured with different data types
● Implement sending and receiving of Data Elements
● Support 1:n and m:1




![img](Receiver
SW-C1
Sender
SW-C0
SW-Cn
1:n
C)
![img](Sender
SW-C1
Receiver
SW-C0
SW-C m
m:1
C)


● Sender-Receiver Concept



















Roof ECU

Light











RTE











Microcontroller

Bus

AUTOSAR BSW

Data element:
Light_Dimmer

Data element:
DoorOpen

Signal:
DoorLeft_Open






“mapping”

Dimmer



























● Example 1
● Communication between SWC and COM
● Map Data Element to CAN signal

Rte_Read_p_o(boolean * val)
{
    Com_ReceiveSignal(sigID, val)
}

Generate Example




● Sender-Receiver Concept

Example 2
● Communication between SWCs




















Roof ECU

Light











RTE











Microcontroller

Bus

AUTOSAR BSW

Data element:
Light_Dimmer

Data element:
DoorOpen

Signal:
DoorLeft_Open






“mapping”

Dimmer





























uint8 Light_Dimmer = 0;

Rte_Write_ p_o(uint8 val)
{
    Light_Dimmer = val
}

Rte_Read_ p_o(uint8 * val)
{
    *val = Light_Dimmer;
}


Generate Example



● Sender-Receiver Configuration for SWC Communication


Interface: At code level, equivalent to variable definition
Port
Runnable/Access: Provide read/write interface
RteEvent


● Sender-Receiver Configuration


● Create New Interface



![img](cs_syn_nomapping
DataTypes
Portlnterface
SWCs
New
Project...
Open References
SenderReceiverinterface
Rename
ClientServerlnterface
Move
ModeSwitchlnterface
Import...
Triggerlnterface
Export...
Other...
Ctrl+N
ShortName)



● Sender-Receiver Configuration


● Create New Data Element

![img](General
Is Service
Service Kind anyStandardized
Data Element
v ADCANFD _ISTrigCCP_020ms PDU00^0
Init Value
Add Data Element
Type
ADCANFD_ISTrigCCP_020n
Delete
Modify Name
Handle Invalid
DataPrototype)

● Sender-Receiver ：Configure Port and Connect


Create new Composition SWC, Atomic SWC
Add port
Connect


![img](CompositionSwComponent
Receiver.Receiver
Sender.Sender
SenderReceiverRPort
SenderReceiverPPort)

● Sender-Receiver ：Configure Runnable and Access


Runnable Access ：Permission to call interface in Runnable
● Access Data Element of SR port


![img](*SwclnternalBehavior ×
Sender
General[Runnables
RTEEvents ExclusiveAreas InterRunnableVariables DataTypeMappings
Runnable0
General
Access
ExclusiveArea
×
Add Delete
Name
Port
Runnable Port Access
Create Data Access, Server Point and Mode Access/Switch.
Types
Dedup Search
Read
Items
Receive By Argument
Receive By Value
SenderReceiverPPort. DataElement0
Send
Write)

● Sender-Receiver：Configure RTE Event



Configure DataReceivedEvent in SWC receiving data：Create new

![img](tmp/112495152898_pptx.dat_46_ppt_media_image38.png)

● Sender-Receiver：Configure RTE Event



Configure DataReceivedEvent in SWC receiving data

![img](*SwclnternalBehavior ×
General[Runnables [RTEEvents
ExclusiveAreas InterRunnableVariables DataTypeMa
DR Event0
Data Receive Event
Data
SenderReceiverRPort DataElementO
Invoke
StartOnEvent RunnableReceive)

● Sender-Receiver：Configure RTE Event



The most basic SR communication is configured
Now add some enhancements……
● How to ensure data consistency for multiple-to-one?——Access
● How to handle signal timeout?——RTEEvent
……




● How to Ensure Data Consistency：Sender-Receiver Access

Runnable Access


|Type|Require / Provide|Explicit / Implicit|RTE API|
|---|---|---|---|
|Receive data by argument|Require|Explicit|Rte_Read(*val)|
|Receive data by value|Require|Explicit|Val = Rte_DRead|
|Read|Require|Implicit|Val = Rte_IRead|
|Send|Provide|Explicit|Rte_Write|
|Write|Provide|Implicit|Rte_IWrite|



● Sender-Receiver Access


Explicit

● Rte_Read/ Rte_DRead /Rte_Write
● Call API in Runnable to access data...